'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'firebase']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {
  //Initiating socket
  var socket = io();

  //Initiating the paper object to be globally available
  function initiate() {
    console.log('initiated!');
    paper.install(window);
    paper.setup('myCanvas');
  };
  initiate();

  //Putting stars on the night sky
  function stars() {
    var center = view.center;
    var points = 5;
    var radius1 = 5;
    var radius2 = 10;
    var star = new Path.Star(center, points, radius1, radius2);

    star.style = {
      fillColor: 'yellow'
    };

    var starArr = [];
    for (var i = 0; i < 100; i++) {
      var starCopy = star.clone();
      var randomPosition = Point.random();
      randomPosition.x = randomPosition.x * view.size._width;
      randomPosition.y = randomPosition.y * view.size._height;
      starCopy.position = randomPosition;
      starCopy.rotate(Math.random() * 20);
      starCopy.scale(0.25 + Math.random() * 0.75);
      starCopy.onMouseMove = function (event) {
        this.opacity = Math.random();
      };
      starArr.push(starCopy);
    }

    star.remove();

    view.onFrame = function (event) {
      for (var i = 0; i < starArr.length; i++) {
        starArr[i].fillColor.hue += (1 - Math.round(Math.random()) * 2) * (Math.random() * 5);
        starArr[i].rotate(Math.random());
        starArr[i].position.x += starArr[i].bounds.width / 200;
        if (starArr[i].bounds.left > view.size.width) {
          starArr[i].position.x = -starArr[i].bounds.width;
        }
      }
    };

    socket.emit('sendtheNight', project.activeLayer);
  };

  stars();
  $scope.stars = stars;

  // Drawing on the night sky
  var tool = new Tool();

  var stroke;
  var path_to_send = {};

  tool.onMouseDown = function (event) {
    stroke = new Path();
    stroke.fillColor = {
      hue: Math.random() * 360,
      saturation: 1,
      brightness: 1
    };
    stroke.add(event.point);

    //defining what to send via sockets
    path_to_send = {
      color: stroke.fillColor,
      start: event.point,
      stroke: []
    };
  };

  tool.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke.add(top);
    stroke.insert(0, bottom);
    stroke.smooth();

    path_to_send.stroke.push({
      top: top,
      bottom: bottom
    });
    //sending my drawing
    socket.emit('meDrawing', JSON.stringify(path_to_send));
  };

  tool.onMouseUp = function (event) {
    stroke.add(event.point);
    stroke.closed = true;
    stroke.smooth();
  };

  // a shadowy night sky
  function shadow() {
    var blackSquare = Path.Rectangle(new Point(0, 0), new Size(view.size._width, view.size._height));
    blackSquare.fillColor = 'black';
    blackSquare.opacity = 0.2;
  }

  $scope.shadow = shadow;

  // creating new tool to "erase" or "clear" the sky
  var tool2 = new Tool();

  var stroke3;
  var path_to_send2 = {};

  tool2.onMouseDown = function (event) {
    stroke3 = new Path();
    stroke3.fillColor = 'green'; //the color does not affect the functionality
    stroke3.opacity = 1;
    stroke3.strokeWidth = 20;
    stroke3.blendMode = 'destination-out'; //conflicts with stroke2.fillColor
    stroke3.add(event.point);
    // defining what to send via sockets
    path_to_send2 = {
      color: stroke3.fillColor,
      start: event.point,
      stroke3: [],
      blendMode: stroke3.blendMode
    };
  };

  tool2.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke3.add(top);
    stroke3.insert(0, bottom);
    stroke3.smooth();

    path_to_send2.stroke3.push({
      top: top,
      bottom: bottom
    });

    //sending my clearing
    socket.emit('clearingTheSky', JSON.stringify(path_to_send2));
  };

  tool2.onMouseUp = function (event) {
    stroke3.add(event.point);
    stroke3.closed = true;
    stroke3.smooth();
  };

  var drawingTools = [tool, tool2];

  //buttons allow toggling between erasing and decorating the sky
  $scope.erase = function () {
    drawingTools[1].activate();
  };

  $scope.decorate = function () {
    drawingTools[0].activate();
  };

  //socket events

  // When friends start drawing
  socket.on('friendsDrawing', function (data) {
    var stroke2 = new Path();
    var friendsDrawing = JSON.parse(data);
    var eachStroke = friendsDrawing.stroke;
    var start_point = new Point(friendsDrawing.start[1], friendsDrawing.start[2]);
    var color = friendsDrawing.color;
    stroke2.fillColor = color;
    stroke2.add(start_point);
    for (var i = 0; i < eachStroke.length; i++) {
      stroke2.add(new Point(eachStroke[i].top[1], eachStroke[i].top[2]));
      stroke2.insert(0, new Point(eachStroke[i].bottom[1], eachStroke[i].bottom[2]));
    }
    stroke2.smooth();
    view.draw();
    view.update();
  });

  //when friends start to clear the sky
  socket.on('friendsClearing', function (data) {
    var stroke4 = new Path();
    var friendsClearing = JSON.parse(data);
    var clearingStroke = friendsClearing.stroke3;
    var start_clear_point = new Point(friendsClearing.start[1], friendsClearing.start[2]);
    var blendMode = friendsClearing.blendMode;
    var color = friendsClearing.color;
    stroke4.blendMode = blendMode;
    stroke4.fillColor = color;
    stroke4.add(start_clear_point);
    for (var i = 0; i < clearingStroke.length; i++) {
      stroke4.add(new Point(clearingStroke[i].top[1], clearingStroke[i].top[2]));
      stroke4.insert(0, new Point(clearingStroke[i].bottom[1], clearingStroke[i].bottom[2]));
    }
    stroke4.smooth();
    view.draw();
    view.update();
  });

  //when friends are also on the page, add 100 more stars to your view every minute
  socket.on('friendsSending', function () {
    window.setInterval(stars, 60000);
    view.update();
  });
});
//sending the night starry night
// socket.emit('sendtheNight', project);
"use strict";

app.factory("DrawingFactory", function ($http) {
  return {
    loadCanvas: function loadCanvas() {
      return $http.get("/").then(function (response) {
        return response.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLmZhY3RvcnkuanMiLCJob21lL2hvbWUuc3RhdGUuanMiLCJuYXZiYXIvbmF2YmFyLmRpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7O0FBRWxFLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxrQkFBa0IsRUFBRSxpQkFBaUIsRUFBRTs7QUFFekQsb0JBQWlCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVsQyxxQkFBa0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDcEMsQ0FBQyxDQUFDOzs7QUNQSCxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLFVBQVMsTUFBTSxFQUFFLEtBQUssRUFBRTs7QUFFdkQsTUFBSSxNQUFNLEdBQUcsRUFBRSxFQUFFLENBQUM7OztBQUdsQixXQUFTLFFBQVEsR0FBSTtBQUNuQixXQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQzFCLFNBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDdEIsU0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztHQUN6QixDQUFDO0FBQ0YsVUFBUSxFQUFFLENBQUM7OztBQUdYLFdBQVMsS0FBSyxHQUFJO0FBQ2hCLFFBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7QUFDekIsUUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsUUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ2hCLFFBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNqQixRQUFJLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFB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USxFQUFFLEdBQUc7QUFDYixhQUFXLEVBQUUseUJBQXlCO0VBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnTWVhbmlzY3VsZScsIFsndWkucm91dGVyJywgJ2ZpcmViYXNlJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAvLyBUaGlzIHR1cm5zIG9mZiBoYXNoYmFuZyB1cmxzICgvI2Fib3V0KSBhbmQgY2hhbmdlcyBpdCB0byBzb21ldGhpbmcgbm9ybWFsICgvYWJvdXQpXG4gICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAvLyBJZiB3ZSBnbyB0byBhIFVSTCB0aGF0IHVpLXJvdXRlciBkb2Vzbid0IGhhdmUgcmVnaXN0ZXJlZCwgZ28gdG8gdGhlIFwiL1wiIHVybC5cbiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgLy9Jbml0aWF0aW5nIHNvY2tldFxuICB2YXIgc29ja2V0ID0gaW8oKTtcblxuICAvL0luaXRpYXRpbmcgdGhlIHBhcGVyIG9iamVjdCB0byBiZSBnbG9iYWxseSBhdmFpbGFibGVcbiAgZnVuY3Rpb24gaW5pdGlhdGUgKCkgeyBcbiAgICBjb25zb2xlLmxvZygnaW5pdGlhdGVkIScpO1xuICAgIHBhcGVyLmluc3RhbGwod2luZG93KTtcbiAgICBwYXBlci5zZXR1cChcIm15Q2FudmFzXCIpO1xuICB9O1xuICBpbml0aWF0ZSgpO1xuXG4gIC8vUHV0dGluZyBzdGFycyBvbiB0aGUgbmlnaHQgc2t5XG4gIGZ1bmN0aW9uIHN0YXJzICgpIHtcbiAgICB2YXIgY2VudGVyID0gdmlldy5jZW50ZXI7XG4gICAgdmFyIHBvaW50cyA9IDU7XG4gICAgdmFyIHJhZGl1czEgPSA1O1xuICAgIHZhciByYWRpdXMyID0gMTA7XG4gICAgdmFyIHN0YXIgPSBuZXcgUGF0aC5TdGFyKGNlbnRlciwgcG9pbnRzLCByYWRpdXMxLCByYWRpdXMyKTtcbiAgICBcbiAgICBzdGFyLnN0eWxlID0ge1xuICAgICAgZmlsbENvbG9yOiAneWVsbG93J1xuICAgIH1cblxuICAgIHZhciBzdGFyQXJyID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgdmFyIHN0YXJDb3B5ID0gc3Rhci5jbG9uZSgpO1xuICAgICAgdmFyIHJhbmRvbVBvc2l0aW9uID0gUG9pbnQucmFuZG9tKCk7XG4gICAgICByYW5kb21Qb3NpdGlvbi54ID0gcmFuZG9tUG9zaXRpb24ueCAqIHZpZXcuc2l6ZS5fd2lkdGg7XG4gICAgICByYW5kb21Qb3NpdGlvbi55ID0gcmFuZG9tUG9zaXRpb24ueSAqIHZpZXcuc2l6ZS5faGVpZ2h0O1xuICAgICAgc3RhckNvcHkucG9zaXRpb24gPSByYW5kb21Qb3NpdGlvbjtcbiAgICAgIHN0YXJDb3B5LnJvdGF0ZShNYXRoLnJhbmRvbSgpICogMjApO1xuICAgICAgc3RhckNvcHkuc2NhbGUoMC4yNSArIE1hdGgucmFuZG9tKCkgKiAwLjc1KTtcbiAgICAgIHN0YXJDb3B5Lm9uTW91c2VNb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdGhpcy5vcGFjaXR5ID0gTWF0aC5yYW5kb20oKTtcbiAgICAgIH1cbiAgICAgIHN0YXJBcnIucHVzaChzdGFyQ29weSk7XG4gICAgfVxuXG4gICAgc3Rhci5yZW1vdmUoKTtcblxuICAgIHZpZXcub25GcmFtZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHN0YXJBcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc3RhckFycltpXS5maWxsQ29sb3IuaHVlICs9ICAoMSAtIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSkgKiAyKSAqIChNYXRoLnJhbmRvbSgpICogNSk7XG4gICAgICAgIHN0YXJBcnJbaV0ucm90YXRlKE1hdGgucmFuZG9tKCkpO1xuICAgICAgICBzdGFyQXJyW2ldLnBvc2l0aW9uLnggKz0gc3RhckFycltpXS5ib3VuZHMud2lkdGggLyAyMDA7XG4gICAgICAgIGlmIChzdGFyQXJyW2ldLmJvdW5kcy5sZWZ0ID4gdmlldy5zaXplLndpZHRoKSB7XG4gICAgICAgICAgc3RhckFycltpXS5wb3NpdGlvbi54ID0gLXN0YXJBcnJbaV0uYm91bmRzLndpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgc29ja2V0LmVtaXQoJ3NlbmR0aGVOaWdodCcsIHByb2plY3QuYWN0aXZlTGF5ZXIpO1xuICB9O1xuICBcbiAgc3RhcnMoKTtcbiAgJHNjb3BlLnN0YXJzID0gc3RhcnNcblxuICAvLyBEcmF3aW5nIG9uIHRoZSBuaWdodCBza3lcbiAgdmFyIHRvb2wgPSBuZXcgVG9vbCgpO1xuXG4gIHZhciBzdHJva2U7XG4gIHZhciBwYXRoX3RvX3NlbmQgPSB7fTtcblxuICB0b29sLm9uTW91c2VEb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgc3Ryb2tlID0gbmV3IFBhdGgoKTtcbiAgICBzdHJva2UuZmlsbENvbG9yID0ge1xuICAgICAgaHVlOiBNYXRoLnJhbmRvbSgpICogMzYwLFxuICAgICAgc2F0dXJhdGlvbjogMSxcbiAgICAgIGJyaWdodG5lc3M6IDFcbiAgICB9O1xuICAgIHN0cm9rZS5hZGQoZXZlbnQucG9pbnQpO1xuXG4gIC8vZGVmaW5pbmcgd2hhdCB0byBzZW5kIHZpYSBzb2NrZXRzXG4gICAgcGF0aF90b19zZW5kID0ge1xuICAgICAgY29sb3I6IHN0cm9rZS5maWxsQ29sb3IsXG4gICAgICBzdGFydDogZXZlbnQucG9pbnQsXG4gICAgICBzdHJva2U6IFtdXG4gICAgfTtcbiAgfTtcblxuICB0b29sLm9uTW91c2VEcmFnID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIHN0ZXAgPSBldmVudC5kZWx0YS5kaXZpZGUoMilcbiAgICBzdGVwLmFuZ2xlICs9IDkwO1xuXG4gICAgdmFyIHRvcCA9IGV2ZW50Lm1pZGRsZVBvaW50LmFkZChzdGVwKTtcbiAgICB2YXIgYm90dG9tID0gZXZlbnQubWlkZGxlUG9pbnQuc3VidHJhY3Qoc3RlcCk7XG5cbiAgICBzdHJva2UuYWRkKHRvcCk7XG4gICAgc3Ryb2tlLmluc2VydCgwLCBib3R0b20pO1xuICAgIHN0cm9rZS5zbW9vdGgoKTtcblxuICAgIHBhdGhfdG9fc2VuZC5zdHJva2UucHVzaCh7XG4gICAgICB0b3A6IHRvcCxcbiAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgfSk7XG4gICAgLy9zZW5kaW5nIG15IGRyYXdpbmdcbiAgICBzb2NrZXQuZW1pdCgnbWVEcmF3aW5nJywgSlNPTi5zdHJpbmdpZnkocGF0aF90b19zZW5kKSk7XG4gIH1cblxuICB0b29sLm9uTW91c2VVcCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHN0cm9rZS5hZGQoZXZlbnQucG9pbnQpO1xuICAgIHN0cm9rZS5jbG9zZWQgPSB0cnVlO1xuICAgIHN0cm9rZS5zbW9vdGgoKTtcbiAgfVxuXG4gIC8vIGEgc2hhZG93eSBuaWdodCBza3lcbiAgZnVuY3Rpb24gc2hhZG93ICgpIHtcbiAgICB2YXIgYmxhY2tTcXVhcmUgPSBQYXRoLlJlY3RhbmdsZShuZXcgUG9pbnQoMCwwKSwgbmV3IFNpemUodmlldy5zaXplLl93aWR0aCx2aWV3LnNpemUuX2hlaWdodCkpO1xuICAgIGJsYWNrU3F1YXJlLmZpbGxDb2xvciA9ICdibGFjayc7XG4gICAgYmxhY2tTcXVhcmUub3BhY2l0eSA9IDAuMjtcbiAgfVxuXG4gICRzY29wZS5zaGFkb3cgPSBzaGFkb3c7XG5cbiAgLy8gY3JlYXRpbmcgbmV3IHRvb2wgdG8gXCJlcmFzZVwiIG9yIFwiY2xlYXJcIiB0aGUgc2t5XG4gIHZhciB0b29sMiA9IG5ldyBUb29sKCk7XG5cbiAgdmFyIHN0cm9rZTM7XG4gIHZhciBwYXRoX3RvX3NlbmQyID0ge307XG5cbiAgdG9vbDIub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UzID0gbmV3IFBhdGgoKTtcbiAgICBzdHJva2UzLmZpbGxDb2xvciA9ICdncmVlbic7IC8vdGhlIGNvbG9yIGRvZXMgbm90IGFmZmVjdCB0aGUgZnVuY3Rpb25hbGl0eVxuICAgIHN0cm9rZTMub3BhY2l0eSA9IDE7XG4gICAgc3Ryb2tlMy5zdHJva2VXaWR0aCA9IDIwO1xuICAgIHN0cm9rZTMuYmxlbmRNb2RlID0gJ2Rlc3RpbmF0aW9uLW91dCc7IC8vY29uZmxpY3RzIHdpdGggc3Ryb2tlMi5maWxsQ29sb3JcbiAgICBzdHJva2UzLmFkZChldmVudC5wb2ludCk7XG4gIC8vIGRlZmluaW5nIHdoYXQgdG8gc2VuZCB2aWEgc29ja2V0c1xuICAgIHBhdGhfdG9fc2VuZDIgPSB7XG4gICAgICBjb2xvcjogc3Ryb2tlMy5maWxsQ29sb3IsXG4gICAgICBzdGFydDogZXZlbnQucG9pbnQsXG4gICAgICBzdHJva2UzOiBbXSxcbiAgICAgIGJsZW5kTW9kZTogc3Ryb2tlMy5ibGVuZE1vZGVcbiAgICB9XG4gIH1cblxuICB0b29sMi5vbk1vdXNlRHJhZyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBzdGVwID0gZXZlbnQuZGVsdGEuZGl2aWRlKDIpXG4gICAgc3RlcC5hbmdsZSArPSA5MDtcblxuICAgIHZhciB0b3AgPSBldmVudC5taWRkbGVQb2ludC5hZGQoc3RlcCk7XG4gICAgdmFyIGJvdHRvbSA9IGV2ZW50Lm1pZGRsZVBvaW50LnN1YnRyYWN0KHN0ZXApO1xuXG4gICAgc3Ryb2tlMy5hZGQodG9wKTtcbiAgICBzdHJva2UzLmluc2VydCgwLCBib3R0b20pO1xuICAgIHN0cm9rZTMuc21vb3RoKCk7XG5cbiAgICBwYXRoX3RvX3NlbmQyLnN0cm9rZTMucHVzaCh7XG4gICAgICB0b3A6IHRvcCxcbiAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgfSk7XG5cbiAgICAvL3NlbmRpbmcgbXkgY2xlYXJpbmdcbiAgICBzb2NrZXQuZW1pdCgnY2xlYXJpbmdUaGVTa3knLCBKU09OLnN0cmluZ2lmeShwYXRoX3RvX3NlbmQyKSk7XG4gIH1cblxuICB0b29sMi5vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UzLmFkZChldmVudC5wb2ludCk7XG4gICAgc3Ryb2tlMy5jbG9zZWQgPSB0cnVlO1xuICAgIHN0cm9rZTMuc21vb3RoKCk7XG4gIH1cblxuICB2YXIgZHJhd2luZ1Rvb2xzID0gW3Rvb2wsIHRvb2wyXTtcblxuXG4vL2J1dHRvbnMgYWxsb3cgdG9nZ2xpbmcgYmV0d2VlbiBlcmFzaW5nIGFuZCBkZWNvcmF0aW5nIHRoZSBza3lcbiAgJHNjb3BlLmVyYXNlID0gZnVuY3Rpb24gKCkge1xuICAgIGRyYXdpbmdUb29sc1sxXS5hY3RpdmF0ZSgpO1xuICB9XG5cbiAgJHNjb3BlLmRlY29yYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGRyYXdpbmdUb29sc1swXS5hY3RpdmF0ZSgpO1xuICB9XG5cblxuLy9zb2NrZXQgZXZlbnRzXG5cbiAgLy8gV2hlbiBmcmllbmRzIHN0YXJ0IGRyYXdpbmdcbiAgc29ja2V0Lm9uKCdmcmllbmRzRHJhd2luZycsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgc3Ryb2tlMiA9IG5ldyBQYXRoKCk7XG4gICAgICB2YXIgZnJpZW5kc0RyYXdpbmcgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgdmFyIGVhY2hTdHJva2UgPSBmcmllbmRzRHJhd2luZy5zdHJva2U7XG4gICAgICB2YXIgc3RhcnRfcG9pbnQgPSBuZXcgUG9pbnQoZnJpZW5kc0RyYXdpbmcuc3RhcnRbMV0sIGZyaWVuZHNEcmF3aW5nLnN0YXJ0WzJdKVxuICAgICAgdmFyIGNvbG9yID0gZnJpZW5kc0RyYXdpbmcuY29sb3JcbiAgICAgIHN0cm9rZTIuZmlsbENvbG9yID0gY29sb3I7XG4gICAgICBzdHJva2UyLmFkZChzdGFydF9wb2ludCk7XG4gICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZWFjaFN0cm9rZS5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHJva2UyLmFkZChuZXcgUG9pbnQoZWFjaFN0cm9rZVtpXS50b3BbMV0sIGVhY2hTdHJva2VbaV0udG9wWzJdKSk7XG4gICAgICAgIHN0cm9rZTIuaW5zZXJ0KDAsIG5ldyBQb2ludChlYWNoU3Ryb2tlW2ldLmJvdHRvbVsxXSwgZWFjaFN0cm9rZVtpXS5ib3R0b21bMl0pKTtcbiAgICAgIH1cbiAgICAgIHN0cm9rZTIuc21vb3RoKCk7XG4gICAgICB2aWV3LmRyYXcoKTtcbiAgICAgIHZpZXcudXBkYXRlKCk7XG4gIH0pO1xuICBcbiAgLy93aGVuIGZyaWVuZHMgc3RhcnQgdG8gY2xlYXIgdGhlIHNreVxuICBzb2NrZXQub24oJ2ZyaWVuZHNDbGVhcmluZycsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdmFyIHN0cm9rZTQgPSBuZXcgUGF0aCgpO1xuICAgIHZhciBmcmllbmRzQ2xlYXJpbmcgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgIHZhciBjbGVhcmluZ1N0cm9rZSA9IGZyaWVuZHNDbGVhcmluZy5zdHJva2UzO1xuICAgIHZhciBzdGFydF9jbGVhcl9wb2ludCA9IG5ldyBQb2ludChmcmllbmRzQ2xlYXJpbmcuc3RhcnRbMV0sIGZyaWVuZHNDbGVhcmluZy5zdGFydFsyXSlcbiAgICB2YXIgYmxlbmRNb2RlID0gZnJpZW5kc0NsZWFyaW5nLmJsZW5kTW9kZTtcbiAgICB2YXIgY29sb3IgPSBmcmllbmRzQ2xlYXJpbmcuY29sb3JcbiAgICBzdHJva2U0LmJsZW5kTW9kZSA9IGJsZW5kTW9kZTtcbiAgICBzdHJva2U0LmZpbGxDb2xvciA9IGNvbG9yO1xuICAgIHN0cm9rZTQuYWRkKHN0YXJ0X2NsZWFyX3BvaW50KTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgY2xlYXJpbmdTdHJva2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN0cm9rZTQuYWRkKG5ldyBQb2ludChjbGVhcmluZ1N0cm9rZVtpXS50b3BbMV0sIGNsZWFyaW5nU3Ryb2tlW2ldLnRvcFsyXSkpO1xuICAgICAgc3Ryb2tlNC5pbnNlcnQoMCwgbmV3IFBvaW50KGNsZWFyaW5nU3Ryb2tlW2ldLmJvdHRvbVsxXSwgY2xlYXJpbmdTdHJva2VbaV0uYm90dG9tWzJdKSk7XG4gICAgfVxuICAgIHN0cm9rZTQuc21vb3RoKCk7XG4gICAgdmlldy5kcmF3KCk7XG4gICAgdmlldy51cGRhdGUoKTsgIFxuICB9KTtcblxuICAvL3doZW4gZnJpZW5kcyBhcmUgYWxzbyBvbiB0aGUgcGFnZSwgYWRkIDEwMCBtb3JlIHN0YXJzIHRvIHlvdXIgdmlldyBldmVyeSBtaW51dGVcbiAgc29ja2V0Lm9uKCdmcmllbmRzU2VuZGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICB3aW5kb3cuc2V0SW50ZXJ2YWwoc3RhcnMsIDYwMDAwKTtcbiAgICB2aWV3LnVwZGF0ZSgpO1xuICB9KVxuXG4gIC8vc2VuZGluZyB0aGUgbmlnaHQgc3RhcnJ5IG5pZ2h0XG4gIC8vIHNvY2tldC5lbWl0KCdzZW5kdGhlTmlnaHQnLCBwcm9qZWN0KTtcblxufSk7XG4iLCJhcHAuZmFjdG9yeSgnRHJhd2luZ0ZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHApIHtcbiAgcmV0dXJuIHtcbiAgICBsb2FkQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KFwiL1wiKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdob21lJywge1xuICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvaG9tZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJ1xuICAgIH0pO1xufSk7IiwiYXBwLmRpcmVjdGl2ZShcIm5hdmJhclwiLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHR0ZW1wbGF0ZVVybDogXCIvYXBwL25hdmJhci9uYXZiYXIuaHRtbFwiXG5cdH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=