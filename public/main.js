'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'firebase']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {
  var socket = io();
  function initiate() {
    console.log('initiated!');
    paper.install(window);
    paper.setup('myCanvas');
  };
  initiate();

  // Drawing on the night sky
  var tool = new Tool();

  var stroke;
  var path_to_send = {};

  tool.onMouseDown = function (event) {
    stroke = new Path();
    stroke.fillColor = {
      hue: Math.random() * 360,
      saturation: 1,
      brightness: 1
    };
    stroke.add(event.point);

    //defining what to send via sockets
    path_to_send = {
      color: stroke.fillColor,
      start: event.point,
      stroke: []
    };
  };

  tool.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke.add(top);
    stroke.insert(0, bottom);
    stroke.smooth();

    path_to_send.stroke.push({
      top: top,
      bottom: bottom
    });
    //emitting my drawing
    socket.emit('meDrawing', JSON.stringify(path_to_send));
  };

  tool.onMouseUp = function (event) {
    stroke.add(event.point);
    stroke.closed = true;
    stroke.smooth();
  };

  // When someone else starts drawing
  socket.on('friendsDrawing', function (data) {
    console.log('friendsDrawing', JSON.parse(data));
    var stroke2 = new Path();
    var friendsDrawing = JSON.parse(data);
    var eachStroke = friendsDrawing.stroke;
    var start_point = new Point(friendsDrawing.start[1], friendsDrawing.start[2]);
    var color = friendsDrawing.color;
    stroke2.fillColor = color;
    stroke2.add(start_point);
    for (var i = 0; i < eachStroke.length; i++) {
      stroke2.add(new Point(eachStroke[i].top[1], eachStroke[i].top[2]));
      stroke2.insert(0, new Point(eachStroke[i].bottom[1], eachStroke[i].bottom[2]));
    }
    stroke2.smooth();
    console.log('here is stroke2', stroke2);
    view.draw();
    view.update();
  });

  //Putting stars on the night sky

  var center = view.center;
  var points = 5;
  var radius1 = 5;
  var radius2 = 10;
  var star = new Path.Star(center, points, radius1, radius2);

  star.style = {
    fillColor: 'yellow'
  };

  var starArr = [];
  for (var i = 0; i < 100; i++) {
    var starCopy = star.clone();
    var randomPosition = Point.random();
    randomPosition.x = randomPosition.x * view.size._width;
    randomPosition.y = randomPosition.y * view.size._height;
    starCopy.position = randomPosition;
    starCopy.rotate(Math.random() * 20);
    starCopy.scale(0.25 + Math.random() * 0.75);
    starCopy.onMouseMove = function (event) {
      this.opacity = Math.random();
    };
    starArr.push(starCopy);
  }

  star.remove();

  view.onFrame = function (event) {
    for (var i = 0; i < starArr.length; i++) {
      starArr[i].fillColor.hue += (1 - Math.round(Math.random()) * 2) * (Math.random() * 5);
      starArr[i].rotate(Math.random());
      starArr[i].position.x += starArr[i].bounds.width / 200;
      if (starArr[i].bounds.left > view.size.width) {
        starArr[i].position.x = -starArr[i].bounds.width;
      }
    }
  };

  //project refers the work done on the canvas

  // a foggy night sky
  // var blackSquare = Path.Rectangle(new Point(0,0), new Size(view.size._width,view.size._height));
  // blackSquare.fillColor = 'black';
  // blackSquare.opacity = 0.85;
  // blackSquare = new Layer();

  // tool.remove();
  // tool.activate(); //does not work

  // creating new tool to clear the fog or "erase" the blackCover on a path
  var tool2 = new Tool();

  var stroke2;
  var path_to_send2 = {};

  tool2.onMouseDown = function (event) {
    stroke2 = new Path();
    stroke2.fillColor = 'green'; //the color does not affect the functionality
    stroke2.opacity = 1;
    stroke2.strokeWidth = 20;
    stroke2.blendMode = 'destination-out'; //conflicts with stroke2.fillColor
    stroke2.add(event.point);
    // defining what to send via sockets
    path_to_send2 = {
      color: stroke2.fillColor,
      start: event.point,
      stroke2: []
    };
  };

  tool2.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke2.add(top);
    stroke2.insert(0, bottom);
    stroke2.smooth();

    path_to_send2.stroke2.push({
      top: top,
      bottom: bottom
    });

    //emitting my drawing
    socket.emit('clearingTheSky', JSON.stringify(path_to_send2));
  };

  tool2.onMouseUp = function (event) {
    stroke2.add(event.point);
    stroke2.closed = true;
    stroke2.smooth();
  };

  var drawingTools = [tool, tool2];

  $scope.erase = function () {
    drawingTools[1].activate();
  };

  $scope.decorate = function () {
    drawingTools[0].activate();
  };

  socket.emit('sendtheNight', project);
  // socket.on('friendsClearing', function(data) {
  //   console.log('friendsClearing', JSON.parse(data));
  // })
});
"use strict";

app.factory("DrawingFactory", function ($http) {
  return {
    loadCanvas: function loadCanvas() {
      return $http.get("/").then(function (response) {
        return response.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLmZhY3RvcnkuanMiLCJob21lL2hvbWUuc3RhdGUuanMiLCJuYXZiYXIvbmF2YmFyLmRpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7O0FBRWxFLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxrQkFBa0IsRUFBRSxpQkFBaUIsRUFBRTs7QUFFekQsb0JBQWlCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVsQyxxQkFBa0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDcEMsQ0FBQyxDQUFDOzs7QUNQSCxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLFVBQVMsTUFBTSxFQUFFLEtBQUssRUFBRTtBQUN2RCxNQUFJLE1BQU0sR0FBRyxFQUFFLEVBQUUsQ0FBQztBQUNsQixXQUFTLFFBQVEsR0FBSTtBQUNuQixXQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQzFCLFNBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDdEIsU0FBSyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztHQUN6QixDQUFDO0FBQ0YsVUFBUSxFQUFFLENBQUM7OztBQUdYLE1BQUksSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7O0FBRXRCLE1BQUksTUFBTSxDQUFDO0FBQ1gsTUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFDOztBQUV0QixNQUFJLENBQUMsV0FBVyxHQUFHLFVBQVUsS0FBSyxFQUFFO0FBQ2xDLFVBQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0FBQ3BCLFVBQU0sQ0FBQyxTQUFTLEdBQUc7QUFDakIsU0FBRyxFQUFFLElBQUksQ0FB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R0FBRyxDQUFDLENBQ3BCLElBQUksQ0FBQyxVQUFVLFFBQVEsRUFBRTtBQUN4QixlQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7T0FDdEIsQ0FBQyxDQUFDO0tBQ0o7R0FDRixDQUFBO0NBQ0YsQ0FBQyxDQUFDOzs7QUNUSCxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsY0FBYyxFQUFFO0FBQ2pDLGtCQUFjLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtBQUN6QixXQUFHLEVBQUUsR0FBRztBQUNSLG1CQUFXLEVBQUUscUJBQXFCO0FBQ2xDLGtCQUFVLEVBQUUsZ0JBQWdCO0tBQy9CLENBQUMsQ0FBQztDQUNOLENBQUMsQ0FBQzs7O0FDTkgsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsWUFBVTtBQUNqQyxRQUFPO0FBQ04sVUFBUSxFQUFFLEdBQUc7QUFDYixhQUFXLEVBQUUseUJBQXlCO0VBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnTWVhbmlzY3VsZScsIFsndWkucm91dGVyJywgJ2ZpcmViYXNlJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAvLyBUaGlzIHR1cm5zIG9mZiBoYXNoYmFuZyB1cmxzICgvI2Fib3V0KSBhbmQgY2hhbmdlcyBpdCB0byBzb21ldGhpbmcgbm9ybWFsICgvYWJvdXQpXG4gICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAvLyBJZiB3ZSBnbyB0byBhIFVSTCB0aGF0IHVpLXJvdXRlciBkb2Vzbid0IGhhdmUgcmVnaXN0ZXJlZCwgZ28gdG8gdGhlIFwiL1wiIHVybC5cbiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgdmFyIHNvY2tldCA9IGlvKCk7XG4gIGZ1bmN0aW9uIGluaXRpYXRlICgpIHsgXG4gICAgY29uc29sZS5sb2coJ2luaXRpYXRlZCEnKTtcbiAgICBwYXBlci5pbnN0YWxsKHdpbmRvdyk7XG4gICAgcGFwZXIuc2V0dXAoXCJteUNhbnZhc1wiKTtcbiAgfTtcbiAgaW5pdGlhdGUoKTtcblxuICAvLyBEcmF3aW5nIG9uIHRoZSBuaWdodCBza3lcbiAgdmFyIHRvb2wgPSBuZXcgVG9vbCgpO1xuXG4gIHZhciBzdHJva2U7XG4gIHZhciBwYXRoX3RvX3NlbmQgPSB7fTtcblxuICB0b29sLm9uTW91c2VEb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgc3Ryb2tlID0gbmV3IFBhdGgoKTtcbiAgICBzdHJva2UuZmlsbENvbG9yID0ge1xuICAgICAgaHVlOiBNYXRoLnJhbmRvbSgpICogMzYwLFxuICAgICAgc2F0dXJhdGlvbjogMSxcbiAgICAgIGJyaWdodG5lc3M6IDFcbiAgICB9O1xuICAgIHN0cm9rZS5hZGQoZXZlbnQucG9pbnQpO1xuXG4gIC8vZGVmaW5pbmcgd2hhdCB0byBzZW5kIHZpYSBzb2NrZXRzXG4gICAgcGF0aF90b19zZW5kID0ge1xuICAgICAgY29sb3I6IHN0cm9rZS5maWxsQ29sb3IsXG4gICAgICBzdGFydDogZXZlbnQucG9pbnQsXG4gICAgICBzdHJva2U6IFtdXG4gICAgfTtcbiAgfTtcblxuICB0b29sLm9uTW91c2VEcmFnID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIHN0ZXAgPSBldmVudC5kZWx0YS5kaXZpZGUoMilcbiAgICBzdGVwLmFuZ2xlICs9IDkwO1xuXG4gICAgdmFyIHRvcCA9IGV2ZW50Lm1pZGRsZVBvaW50LmFkZChzdGVwKTtcbiAgICB2YXIgYm90dG9tID0gZXZlbnQubWlkZGxlUG9pbnQuc3VidHJhY3Qoc3RlcCk7XG5cbiAgICBzdHJva2UuYWRkKHRvcCk7XG4gICAgc3Ryb2tlLmluc2VydCgwLCBib3R0b20pO1xuICAgIHN0cm9rZS5zbW9vdGgoKTtcblxuICAgIHBhdGhfdG9fc2VuZC5zdHJva2UucHVzaCh7XG4gICAgICB0b3A6IHRvcCxcbiAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgfSk7XG4gICAgLy9lbWl0dGluZyBteSBkcmF3aW5nXG4gICAgc29ja2V0LmVtaXQoJ21lRHJhd2luZycsIEpTT04uc3RyaW5naWZ5KHBhdGhfdG9fc2VuZCkpO1xuICB9XG5cbiAgdG9vbC5vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UuYWRkKGV2ZW50LnBvaW50KTtcbiAgICBzdHJva2UuY2xvc2VkID0gdHJ1ZTtcbiAgICBzdHJva2Uuc21vb3RoKCk7XG4gIH1cblxuICAvLyBXaGVuIHNvbWVvbmUgZWxzZSBzdGFydHMgZHJhd2luZ1xuICBzb2NrZXQub24oJ2ZyaWVuZHNEcmF3aW5nJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgY29uc29sZS5sb2coJ2ZyaWVuZHNEcmF3aW5nJywgSlNPTi5wYXJzZShkYXRhKSk7XG4gICAgICB2YXIgc3Ryb2tlMiA9IG5ldyBQYXRoKCk7XG4gICAgICB2YXIgZnJpZW5kc0RyYXdpbmcgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgdmFyIGVhY2hTdHJva2UgPSBmcmllbmRzRHJhd2luZy5zdHJva2U7XG4gICAgICB2YXIgc3RhcnRfcG9pbnQgPSBuZXcgUG9pbnQoZnJpZW5kc0RyYXdpbmcuc3RhcnRbMV0sIGZyaWVuZHNEcmF3aW5nLnN0YXJ0WzJdKVxuICAgICAgdmFyIGNvbG9yID0gZnJpZW5kc0RyYXdpbmcuY29sb3JcbiAgICAgIHN0cm9rZTIuZmlsbENvbG9yID0gY29sb3I7XG4gICAgICBzdHJva2UyLmFkZChzdGFydF9wb2ludCk7XG4gICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZWFjaFN0cm9rZS5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHJva2UyLmFkZChuZXcgUG9pbnQoZWFjaFN0cm9rZVtpXS50b3BbMV0sIGVhY2hTdHJva2VbaV0udG9wWzJdKSk7XG4gICAgICAgIHN0cm9rZTIuaW5zZXJ0KDAsIG5ldyBQb2ludChlYWNoU3Ryb2tlW2ldLmJvdHRvbVsxXSwgZWFjaFN0cm9rZVtpXS5ib3R0b21bMl0pKTtcbiAgICAgIH1cbiAgICAgIHN0cm9rZTIuc21vb3RoKCk7XG4gICAgICBjb25zb2xlLmxvZygnaGVyZSBpcyBzdHJva2UyJywgc3Ryb2tlMik7XG4gICAgICB2aWV3LmRyYXcoKTtcbiAgICAgIHZpZXcudXBkYXRlKCk7XG4gIH0pO1xuXG4gIC8vUHV0dGluZyBzdGFycyBvbiB0aGUgbmlnaHQgc2t5XG5cbiAgdmFyIGNlbnRlciA9IHZpZXcuY2VudGVyO1xuICB2YXIgcG9pbnRzID0gNTtcbiAgdmFyIHJhZGl1czEgPSA1O1xuICB2YXIgcmFkaXVzMiA9IDEwO1xuICB2YXIgc3RhciA9IG5ldyBQYXRoLlN0YXIoY2VudGVyLCBwb2ludHMsIHJhZGl1czEsIHJhZGl1czIpO1xuICBcbiAgc3Rhci5zdHlsZSA9IHtcbiAgICBmaWxsQ29sb3I6ICd5ZWxsb3cnXG4gIH1cblxuICB2YXIgc3RhckFyciA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgdmFyIHN0YXJDb3B5ID0gc3Rhci5jbG9uZSgpO1xuICAgIHZhciByYW5kb21Qb3NpdGlvbiA9IFBvaW50LnJhbmRvbSgpO1xuICAgIHJhbmRvbVBvc2l0aW9uLnggPSByYW5kb21Qb3NpdGlvbi54ICogdmlldy5zaXplLl93aWR0aDtcbiAgICByYW5kb21Qb3NpdGlvbi55ID0gcmFuZG9tUG9zaXRpb24ueSAqIHZpZXcuc2l6ZS5faGVpZ2h0O1xuICAgIHN0YXJDb3B5LnBvc2l0aW9uID0gcmFuZG9tUG9zaXRpb247XG4gICAgc3RhckNvcHkucm90YXRlKE1hdGgucmFuZG9tKCkgKiAyMCk7XG4gICAgc3RhckNvcHkuc2NhbGUoMC4yNSArIE1hdGgucmFuZG9tKCkgKiAwLjc1KTtcbiAgICBzdGFyQ29weS5vbk1vdXNlTW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB0aGlzLm9wYWNpdHkgPSBNYXRoLnJhbmRvbSgpO1xuICAgIH1cbiAgICBzdGFyQXJyLnB1c2goc3RhckNvcHkpO1xuICB9XG5cbiAgc3Rhci5yZW1vdmUoKTtcblxuICB2aWV3Lm9uRnJhbWUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgc3RhckFyci5sZW5ndGg7IGkrKykge1xuICAgICAgc3RhckFycltpXS5maWxsQ29sb3IuaHVlICs9ICAoMSAtIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSkgKiAyKSAqIChNYXRoLnJhbmRvbSgpICogNSk7XG4gICAgICBzdGFyQXJyW2ldLnJvdGF0ZShNYXRoLnJhbmRvbSgpKTtcbiAgICAgIHN0YXJBcnJbaV0ucG9zaXRpb24ueCArPSBzdGFyQXJyW2ldLmJvdW5kcy53aWR0aCAvIDIwMDtcbiAgICAgIGlmIChzdGFyQXJyW2ldLmJvdW5kcy5sZWZ0ID4gdmlldy5zaXplLndpZHRoKSB7XG4gICAgICAgIHN0YXJBcnJbaV0ucG9zaXRpb24ueCA9IC1zdGFyQXJyW2ldLmJvdW5kcy53aWR0aDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vcHJvamVjdCByZWZlcnMgdGhlIHdvcmsgZG9uZSBvbiB0aGUgY2FudmFzXG5cbiAgLy8gYSBmb2dneSBuaWdodCBza3lcbiAgLy8gdmFyIGJsYWNrU3F1YXJlID0gUGF0aC5SZWN0YW5nbGUobmV3IFBvaW50KDAsMCksIG5ldyBTaXplKHZpZXcuc2l6ZS5fd2lkdGgsdmlldy5zaXplLl9oZWlnaHQpKTtcbiAgLy8gYmxhY2tTcXVhcmUuZmlsbENvbG9yID0gJ2JsYWNrJztcbiAgLy8gYmxhY2tTcXVhcmUub3BhY2l0eSA9IDAuODU7XG4gIC8vIGJsYWNrU3F1YXJlID0gbmV3IExheWVyKCk7XG5cblxuICAvLyB0b29sLnJlbW92ZSgpO1xuICAvLyB0b29sLmFjdGl2YXRlKCk7IC8vZG9lcyBub3Qgd29ya1xuXG4gIC8vIGNyZWF0aW5nIG5ldyB0b29sIHRvIGNsZWFyIHRoZSBmb2cgb3IgXCJlcmFzZVwiIHRoZSBibGFja0NvdmVyIG9uIGEgcGF0aFxuICB2YXIgdG9vbDIgPSBuZXcgVG9vbCgpO1xuXG4gIHZhciBzdHJva2UyO1xuICB2YXIgcGF0aF90b19zZW5kMiA9IHt9O1xuXG4gIHRvb2wyLm9uTW91c2VEb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgc3Ryb2tlMiA9IG5ldyBQYXRoKCk7XG4gICAgc3Ryb2tlMi5maWxsQ29sb3IgPSAnZ3JlZW4nOyAvL3RoZSBjb2xvciBkb2VzIG5vdCBhZmZlY3QgdGhlIGZ1bmN0aW9uYWxpdHlcbiAgICBzdHJva2UyLm9wYWNpdHkgPSAxO1xuICAgIHN0cm9rZTIuc3Ryb2tlV2lkdGggPSAyMDtcbiAgICBzdHJva2UyLmJsZW5kTW9kZSA9ICdkZXN0aW5hdGlvbi1vdXQnOyAvL2NvbmZsaWN0cyB3aXRoIHN0cm9rZTIuZmlsbENvbG9yXG4gICAgc3Ryb2tlMi5hZGQoZXZlbnQucG9pbnQpO1xuICAvLyBkZWZpbmluZyB3aGF0IHRvIHNlbmQgdmlhIHNvY2tldHNcbiAgICBwYXRoX3RvX3NlbmQyID0ge1xuICAgICAgY29sb3I6IHN0cm9rZTIuZmlsbENvbG9yLFxuICAgICAgc3RhcnQ6IGV2ZW50LnBvaW50LFxuICAgICAgc3Ryb2tlMjogW11cbiAgICB9XG4gIH1cblxuICB0b29sMi5vbk1vdXNlRHJhZyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBzdGVwID0gZXZlbnQuZGVsdGEuZGl2aWRlKDIpXG4gICAgc3RlcC5hbmdsZSArPSA5MDtcblxuICAgIHZhciB0b3AgPSBldmVudC5taWRkbGVQb2ludC5hZGQoc3RlcCk7XG4gICAgdmFyIGJvdHRvbSA9IGV2ZW50Lm1pZGRsZVBvaW50LnN1YnRyYWN0KHN0ZXApO1xuXG4gICAgc3Ryb2tlMi5hZGQodG9wKTtcbiAgICBzdHJva2UyLmluc2VydCgwLCBib3R0b20pO1xuICAgIHN0cm9rZTIuc21vb3RoKCk7XG5cbiAgICBwYXRoX3RvX3NlbmQyLnN0cm9rZTIucHVzaCh7XG4gICAgICB0b3A6IHRvcCxcbiAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgfSk7XG5cbiAgICAvL2VtaXR0aW5nIG15IGRyYXdpbmdcbiAgICBzb2NrZXQuZW1pdCgnY2xlYXJpbmdUaGVTa3knLCBKU09OLnN0cmluZ2lmeShwYXRoX3RvX3NlbmQyKSk7XG4gIH1cblxuICB0b29sMi5vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UyLmFkZChldmVudC5wb2ludCk7XG4gICAgc3Ryb2tlMi5jbG9zZWQgPSB0cnVlO1xuICAgIHN0cm9rZTIuc21vb3RoKCk7XG4gIH1cblxuICB2YXIgZHJhd2luZ1Rvb2xzID0gW3Rvb2wsIHRvb2wyXTtcblxuICAkc2NvcGUuZXJhc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgZHJhd2luZ1Rvb2xzWzFdLmFjdGl2YXRlKCk7XG4gIH1cblxuICAkc2NvcGUuZGVjb3JhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgZHJhd2luZ1Rvb2xzWzBdLmFjdGl2YXRlKCk7XG4gIH1cblxuICBzb2NrZXQuZW1pdCgnc2VuZHRoZU5pZ2h0JywgcHJvamVjdCk7XG4gIC8vIHNvY2tldC5vbignZnJpZW5kc0NsZWFyaW5nJywgZnVuY3Rpb24oZGF0YSkge1xuICAvLyAgIGNvbnNvbGUubG9nKCdmcmllbmRzQ2xlYXJpbmcnLCBKU09OLnBhcnNlKGRhdGEpKTtcbiAgLy8gfSlcblxufSk7XG4iLCJhcHAuZmFjdG9yeSgnRHJhd2luZ0ZhY3RvcnknLCBmdW5jdGlvbiAoJGh0dHApIHtcbiAgcmV0dXJuIHtcbiAgICBsb2FkQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KFwiL1wiKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdob21lJywge1xuICAgICAgICB1cmw6ICcvJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvaG9tZS5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJ1xuICAgIH0pO1xufSk7IiwiYXBwLmRpcmVjdGl2ZShcIm5hdmJhclwiLCBmdW5jdGlvbigpe1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiBcIkVcIixcblx0XHR0ZW1wbGF0ZVVybDogXCIvYXBwL25hdmJhci9uYXZiYXIuaHRtbFwiXG5cdH07XG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=