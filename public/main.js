'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'firebase']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {

  //Initiating socket
  var socket = io();

  //Initiating the paper object to be globally available
  function initiate() {
    console.log('initiated!');
    paper.install(window);
    paper.setup('myCanvas');
  };
  initiate();

  //Putting stars on the night sky

  var center = view.center;
  var points = 5;
  var radius1 = 5;
  var radius2 = 10;
  var star = new Path.Star(center, points, radius1, radius2);

  star.style = {
    fillColor: 'yellow'
  };

  var starArr = [];
  for (var i = 0; i < 100; i++) {
    var starCopy = star.clone();
    var randomPosition = Point.random();
    randomPosition.x = randomPosition.x * view.size._width;
    randomPosition.y = randomPosition.y * view.size._height;
    starCopy.position = randomPosition;
    starCopy.rotate(Math.random() * 20);
    starCopy.scale(0.25 + Math.random() * 0.75);
    starCopy.onMouseMove = function (event) {
      this.opacity = Math.random();
    };
    starArr.push(starCopy);
  }

  star.remove();

  view.onFrame = function (event) {
    for (var i = 0; i < starArr.length; i++) {
      starArr[i].fillColor.hue += (1 - Math.round(Math.random()) * 2) * (Math.random() * 5);
      starArr[i].rotate(Math.random());
      starArr[i].position.x += starArr[i].bounds.width / 200;
      if (starArr[i].bounds.left > view.size.width) {
        starArr[i].position.x = -starArr[i].bounds.width;
      }
    }
  };

  // Drawing on the night sky
  var tool = new Tool();

  var stroke;
  var path_to_send = {};

  tool.onMouseDown = function (event) {
    stroke = new Path();
    stroke.fillColor = {
      hue: Math.random() * 360,
      saturation: 1,
      brightness: 1
    };
    stroke.add(event.point);

    //defining what to send via sockets
    path_to_send = {
      color: stroke.fillColor,
      start: event.point,
      stroke: []
    };
  };

  tool.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke.add(top);
    stroke.insert(0, bottom);
    stroke.smooth();

    path_to_send.stroke.push({
      top: top,
      bottom: bottom
    });
    //sending my drawing
    socket.emit('meDrawing', JSON.stringify(path_to_send));
  };

  tool.onMouseUp = function (event) {
    stroke.add(event.point);
    stroke.closed = true;
    stroke.smooth();
  };

  // a foggy night sky
  // var blackSquare = Path.Rectangle(new Point(0,0), new Size(view.size._width,view.size._height));
  // blackSquare.fillColor = 'black';
  // blackSquare.opacity = 0.85;
  // blackSquare = new Layer();

  // creating new tool to "erase" or "clear" the sky
  var tool2 = new Tool();

  var stroke3;
  var path_to_send2 = {};

  tool2.onMouseDown = function (event) {
    stroke3 = new Path();
    stroke3.fillColor = 'green'; //the color does not affect the functionality
    stroke3.opacity = 1;
    stroke3.strokeWidth = 20;
    stroke3.blendMode = 'destination-out'; //conflicts with stroke2.fillColor
    stroke3.add(event.point);
    // defining what to send via sockets
    path_to_send2 = {
      color: stroke3.fillColor,
      start: event.point,
      stroke3: [],
      blendMode: stroke3.blendMode
    };
  };

  tool2.onMouseDrag = function (event) {
    var step = event.delta.divide(2);
    step.angle += 90;

    var top = event.middlePoint.add(step);
    var bottom = event.middlePoint.subtract(step);

    stroke3.add(top);
    stroke3.insert(0, bottom);
    stroke3.smooth();

    path_to_send2.stroke3.push({
      top: top,
      bottom: bottom
    });

    //sending my clearing
    socket.emit('clearingTheSky', JSON.stringify(path_to_send2));
  };

  tool2.onMouseUp = function (event) {
    stroke3.add(event.point);
    stroke3.closed = true;
    stroke3.smooth();
  };

  var drawingTools = [tool, tool2];

  //buttons allow toggling between erasing and decorating the sky
  $scope.erase = function () {
    drawingTools[1].activate();
  };

  $scope.decorate = function () {
    drawingTools[0].activate();
  };

  //socket events

  // When friends start drawing
  socket.on('friendsDrawing', function (data) {
    console.log('friendsDrawing', JSON.parse(data));
    var stroke2 = new Path();
    var friendsDrawing = JSON.parse(data);
    var eachStroke = friendsDrawing.stroke;
    var start_point = new Point(friendsDrawing.start[1], friendsDrawing.start[2]);
    var color = friendsDrawing.color;
    stroke2.fillColor = color;
    stroke2.add(start_point);
    for (var i = 0; i < eachStroke.length; i++) {
      stroke2.add(new Point(eachStroke[i].top[1], eachStroke[i].top[2]));
      stroke2.insert(0, new Point(eachStroke[i].bottom[1], eachStroke[i].bottom[2]));
    }
    stroke2.smooth();
    console.log('here is stroke2', stroke2);
    view.draw();
    view.update();
  });

  //when friends start to clear the sky
  socket.on('friendsClearing', function (data) {
    console.log('friendClearing', JSON.parse(data));
    var stroke4 = new Path();
    var friendsClearing = JSON.parse(data);
    var clearingStroke = friendsClearing.stroke3;
    var start_clear_point = new Point(friendsClearing.start[1], friendsClearing.start[2]);
    var blendMode = friendsClearing.blendMode;
    var color = friendsClearing.color;
    stroke4.blendMode = blendMode;
    stroke4.fillColor = color;
    stroke4.add(start_clear_point);
    for (var i = 0; i < clearingStroke.length; i++) {
      stroke4.add(new Point(clearingStroke[i].top[1], clearingStroke[i].top[2]));
      stroke4.insert(0, new Point(clearingStroke[i].bottom[1], clearingStroke[i].bottom[2]));
    }
    stroke4.smooth();
    view.draw();
    view.update();
  });

  //sending the night starry night
  socket.emit('sendtheNight', project);
});
"use strict";

app.factory("DrawingFactory", function ($http) {
  return {
    loadCanvas: function loadCanvas() {
      return $http.get("/").then(function (response) {
        return response.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLmZhY3RvcnkuanMiLCJob21lL2hvbWUuc3RhdGUuanMiLCJuYXZiYXIvbmF2YmFyLmRpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7O0FBRWxFLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxrQkFBa0IsRUFBRSxpQkFBaUIsRUFBRTs7QUFFekQsb0JBQWlCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVsQyxxQkFBa0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDcEMsQ0FBQyxDQUFDOzs7QUNQSCxHQUFHLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLFVBQVMsTUFBTSxFQUFFLEtBQUssRUFBRTs7O0FBR3ZELE1BQUksTUFBTSxHQUFHLEVBQUUsRUFBRSxDQUFDOzs7QUFHbEIsV0FBUyxRQUFRLEdBQUk7QUFDbkIsV0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUMxQixTQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3RCLFNBQUssQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7R0FDekIsQ0FBQztBQUNGLFVBQVEsRUFBRSxDQUFDOzs7O0FBSVgsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUN6QixNQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7QUFDZixNQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFDaEIsTUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLE1BQUksSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENB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TUFBTSxFQUFFLENBQUM7R0FDZixDQUFDLENBQUM7OztBQUdILFFBQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0NBRXRDLENBQUMsQ0FBQzs7O0FDdE5ILEdBQUcsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDN0MsU0FBTztBQUNMLGNBQVUsRUFBRSxzQkFBWTtBQUN0QixhQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQ3BCLElBQUksQ0FBQyxVQUFVLFFBQVEsRUFBRTtBQUN4QixlQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7T0FDdEIsQ0FBQyxDQUFDO0tBQ0o7R0FDRixDQUFBO0NBQ0YsQ0FBQyxDQUFDOzs7QUNUSCxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsY0FBYyxFQUFFO0FBQ2pDLGtCQUFjLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtBQUN6QixXQUFHLEVBQUUsR0FBRztBQUNSLG1CQUFXLEVBQUUscUJBQXFCO0FBQ2xDLGtCQUFVLEVBQUUsZ0JBQWdCO0tBQy9CLENBQUMsQ0FBQztDQUNOLENBQUMsQ0FBQzs7O0FDTkgsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsWUFBVTtBQUNqQyxRQUFPO0FBQ04sVUFBUSxFQUFFLEdBQUc7QUFDYixhQUFXLEVBQUUseUJBQXlCO0VBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnTWVhbmlzY3VsZScsIFsndWkucm91dGVyJywgJ2ZpcmViYXNlJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAvLyBUaGlzIHR1cm5zIG9mZiBoYXNoYmFuZyB1cmxzICgvI2Fib3V0KSBhbmQgY2hhbmdlcyBpdCB0byBzb21ldGhpbmcgbm9ybWFsICgvYWJvdXQpXG4gICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAvLyBJZiB3ZSBnbyB0byBhIFVSTCB0aGF0IHVpLXJvdXRlciBkb2Vzbid0IGhhdmUgcmVnaXN0ZXJlZCwgZ28gdG8gdGhlIFwiL1wiIHVybC5cbiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcblxuICAvL0luaXRpYXRpbmcgc29ja2V0XG4gIHZhciBzb2NrZXQgPSBpbygpO1xuXG4gIC8vSW5pdGlhdGluZyB0aGUgcGFwZXIgb2JqZWN0IHRvIGJlIGdsb2JhbGx5IGF2YWlsYWJsZVxuICBmdW5jdGlvbiBpbml0aWF0ZSAoKSB7IFxuICAgIGNvbnNvbGUubG9nKCdpbml0aWF0ZWQhJyk7XG4gICAgcGFwZXIuaW5zdGFsbCh3aW5kb3cpO1xuICAgIHBhcGVyLnNldHVwKFwibXlDYW52YXNcIik7XG4gIH07XG4gIGluaXRpYXRlKCk7XG5cbiAgLy9QdXR0aW5nIHN0YXJzIG9uIHRoZSBuaWdodCBza3lcblxuICB2YXIgY2VudGVyID0gdmlldy5jZW50ZXI7XG4gIHZhciBwb2ludHMgPSA1O1xuICB2YXIgcmFkaXVzMSA9IDU7XG4gIHZhciByYWRpdXMyID0gMTA7XG4gIHZhciBzdGFyID0gbmV3IFBhdGguU3RhcihjZW50ZXIsIHBvaW50cywgcmFkaXVzMSwgcmFkaXVzMik7XG4gIFxuICBzdGFyLnN0eWxlID0ge1xuICAgIGZpbGxDb2xvcjogJ3llbGxvdydcbiAgfVxuXG4gIHZhciBzdGFyQXJyID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICB2YXIgc3RhckNvcHkgPSBzdGFyLmNsb25lKCk7XG4gICAgdmFyIHJhbmRvbVBvc2l0aW9uID0gUG9pbnQucmFuZG9tKCk7XG4gICAgcmFuZG9tUG9zaXRpb24ueCA9IHJhbmRvbVBvc2l0aW9uLnggKiB2aWV3LnNpemUuX3dpZHRoO1xuICAgIHJhbmRvbVBvc2l0aW9uLnkgPSByYW5kb21Qb3NpdGlvbi55ICogdmlldy5zaXplLl9oZWlnaHQ7XG4gICAgc3RhckNvcHkucG9zaXRpb24gPSByYW5kb21Qb3NpdGlvbjtcbiAgICBzdGFyQ29weS5yb3RhdGUoTWF0aC5yYW5kb20oKSAqIDIwKTtcbiAgICBzdGFyQ29weS5zY2FsZSgwLjI1ICsgTWF0aC5yYW5kb20oKSAqIDAuNzUpO1xuICAgIHN0YXJDb3B5Lm9uTW91c2VNb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHRoaXMub3BhY2l0eSA9IE1hdGgucmFuZG9tKCk7XG4gICAgfVxuICAgIHN0YXJBcnIucHVzaChzdGFyQ29weSk7XG4gIH1cblxuICBzdGFyLnJlbW92ZSgpO1xuXG4gIHZpZXcub25GcmFtZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBzdGFyQXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdGFyQXJyW2ldLmZpbGxDb2xvci5odWUgKz0gICgxIC0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKSAqIDIpICogKE1hdGgucmFuZG9tKCkgKiA1KTtcbiAgICAgIHN0YXJBcnJbaV0ucm90YXRlKE1hdGgucmFuZG9tKCkpO1xuICAgICAgc3RhckFycltpXS5wb3NpdGlvbi54ICs9IHN0YXJBcnJbaV0uYm91bmRzLndpZHRoIC8gMjAwO1xuICAgICAgaWYgKHN0YXJBcnJbaV0uYm91bmRzLmxlZnQgPiB2aWV3LnNpemUud2lkdGgpIHtcbiAgICAgICAgc3RhckFycltpXS5wb3NpdGlvbi54ID0gLXN0YXJBcnJbaV0uYm91bmRzLndpZHRoO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIERyYXdpbmcgb24gdGhlIG5pZ2h0IHNreVxuICB2YXIgdG9vbCA9IG5ldyBUb29sKCk7XG5cbiAgdmFyIHN0cm9rZTtcbiAgdmFyIHBhdGhfdG9fc2VuZCA9IHt9O1xuXG4gIHRvb2wub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UgPSBuZXcgUGF0aCgpO1xuICAgIHN0cm9rZS5maWxsQ29sb3IgPSB7XG4gICAgICBodWU6IE1hdGgucmFuZG9tKCkgKiAzNjAsXG4gICAgICBzYXR1cmF0aW9uOiAxLFxuICAgICAgYnJpZ2h0bmVzczogMVxuICAgIH07XG4gICAgc3Ryb2tlLmFkZChldmVudC5wb2ludCk7XG5cbiAgLy9kZWZpbmluZyB3aGF0IHRvIHNlbmQgdmlhIHNvY2tldHNcbiAgICBwYXRoX3RvX3NlbmQgPSB7XG4gICAgICBjb2xvcjogc3Ryb2tlLmZpbGxDb2xvcixcbiAgICAgIHN0YXJ0OiBldmVudC5wb2ludCxcbiAgICAgIHN0cm9rZTogW11cbiAgICB9O1xuICB9O1xuXG4gIHRvb2wub25Nb3VzZURyYWcgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgc3RlcCA9IGV2ZW50LmRlbHRhLmRpdmlkZSgyKVxuICAgIHN0ZXAuYW5nbGUgKz0gOTA7XG5cbiAgICB2YXIgdG9wID0gZXZlbnQubWlkZGxlUG9pbnQuYWRkKHN0ZXApO1xuICAgIHZhciBib3R0b20gPSBldmVudC5taWRkbGVQb2ludC5zdWJ0cmFjdChzdGVwKTtcblxuICAgIHN0cm9rZS5hZGQodG9wKTtcbiAgICBzdHJva2UuaW5zZXJ0KDAsIGJvdHRvbSk7XG4gICAgc3Ryb2tlLnNtb290aCgpO1xuXG4gICAgcGF0aF90b19zZW5kLnN0cm9rZS5wdXNoKHtcbiAgICAgIHRvcDogdG9wLFxuICAgICAgYm90dG9tOiBib3R0b21cbiAgICB9KTtcbiAgICAvL3NlbmRpbmcgbXkgZHJhd2luZ1xuICAgIHNvY2tldC5lbWl0KCdtZURyYXdpbmcnLCBKU09OLnN0cmluZ2lmeShwYXRoX3RvX3NlbmQpKTtcbiAgfVxuXG4gIHRvb2wub25Nb3VzZVVwID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgc3Ryb2tlLmFkZChldmVudC5wb2ludCk7XG4gICAgc3Ryb2tlLmNsb3NlZCA9IHRydWU7XG4gICAgc3Ryb2tlLnNtb290aCgpO1xuICB9XG5cbiAgLy8gYSBmb2dneSBuaWdodCBza3lcbiAgLy8gdmFyIGJsYWNrU3F1YXJlID0gUGF0aC5SZWN0YW5nbGUobmV3IFBvaW50KDAsMCksIG5ldyBTaXplKHZpZXcuc2l6ZS5fd2lkdGgsdmlldy5zaXplLl9oZWlnaHQpKTtcbiAgLy8gYmxhY2tTcXVhcmUuZmlsbENvbG9yID0gJ2JsYWNrJztcbiAgLy8gYmxhY2tTcXVhcmUub3BhY2l0eSA9IDAuODU7XG4gIC8vIGJsYWNrU3F1YXJlID0gbmV3IExheWVyKCk7XG5cbiAgLy8gY3JlYXRpbmcgbmV3IHRvb2wgdG8gXCJlcmFzZVwiIG9yIFwiY2xlYXJcIiB0aGUgc2t5XG4gIHZhciB0b29sMiA9IG5ldyBUb29sKCk7XG5cbiAgdmFyIHN0cm9rZTM7XG4gIHZhciBwYXRoX3RvX3NlbmQyID0ge307XG5cbiAgdG9vbDIub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UzID0gbmV3IFBhdGgoKTtcbiAgICBzdHJva2UzLmZpbGxDb2xvciA9ICdncmVlbic7IC8vdGhlIGNvbG9yIGRvZXMgbm90IGFmZmVjdCB0aGUgZnVuY3Rpb25hbGl0eVxuICAgIHN0cm9rZTMub3BhY2l0eSA9IDE7XG4gICAgc3Ryb2tlMy5zdHJva2VXaWR0aCA9IDIwO1xuICAgIHN0cm9rZTMuYmxlbmRNb2RlID0gJ2Rlc3RpbmF0aW9uLW91dCc7IC8vY29uZmxpY3RzIHdpdGggc3Ryb2tlMi5maWxsQ29sb3JcbiAgICBzdHJva2UzLmFkZChldmVudC5wb2ludCk7XG4gIC8vIGRlZmluaW5nIHdoYXQgdG8gc2VuZCB2aWEgc29ja2V0c1xuICAgIHBhdGhfdG9fc2VuZDIgPSB7XG4gICAgICBjb2xvcjogc3Ryb2tlMy5maWxsQ29sb3IsXG4gICAgICBzdGFydDogZXZlbnQucG9pbnQsXG4gICAgICBzdHJva2UzOiBbXSxcbiAgICAgIGJsZW5kTW9kZTogc3Ryb2tlMy5ibGVuZE1vZGVcbiAgICB9XG4gIH1cblxuICB0b29sMi5vbk1vdXNlRHJhZyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBzdGVwID0gZXZlbnQuZGVsdGEuZGl2aWRlKDIpXG4gICAgc3RlcC5hbmdsZSArPSA5MDtcblxuICAgIHZhciB0b3AgPSBldmVudC5taWRkbGVQb2ludC5hZGQoc3RlcCk7XG4gICAgdmFyIGJvdHRvbSA9IGV2ZW50Lm1pZGRsZVBvaW50LnN1YnRyYWN0KHN0ZXApO1xuXG4gICAgc3Ryb2tlMy5hZGQodG9wKTtcbiAgICBzdHJva2UzLmluc2VydCgwLCBib3R0b20pO1xuICAgIHN0cm9rZTMuc21vb3RoKCk7XG5cbiAgICBwYXRoX3RvX3NlbmQyLnN0cm9rZTMucHVzaCh7XG4gICAgICB0b3A6IHRvcCxcbiAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgfSk7XG5cbiAgICAvL3NlbmRpbmcgbXkgY2xlYXJpbmdcbiAgICBzb2NrZXQuZW1pdCgnY2xlYXJpbmdUaGVTa3knLCBKU09OLnN0cmluZ2lmeShwYXRoX3RvX3NlbmQyKSk7XG4gIH1cblxuICB0b29sMi5vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBzdHJva2UzLmFkZChldmVudC5wb2ludCk7XG4gICAgc3Ryb2tlMy5jbG9zZWQgPSB0cnVlO1xuICAgIHN0cm9rZTMuc21vb3RoKCk7XG4gIH1cblxuICB2YXIgZHJhd2luZ1Rvb2xzID0gW3Rvb2wsIHRvb2wyXTtcblxuXG4vL2J1dHRvbnMgYWxsb3cgdG9nZ2xpbmcgYmV0d2VlbiBlcmFzaW5nIGFuZCBkZWNvcmF0aW5nIHRoZSBza3lcbiAgJHNjb3BlLmVyYXNlID0gZnVuY3Rpb24gKCkge1xuICAgIGRyYXdpbmdUb29sc1sxXS5hY3RpdmF0ZSgpO1xuICB9XG5cbiAgJHNjb3BlLmRlY29yYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGRyYXdpbmdUb29sc1swXS5hY3RpdmF0ZSgpO1xuICB9XG5cblxuLy9zb2NrZXQgZXZlbnRzXG5cbiAgLy8gV2hlbiBmcmllbmRzIHN0YXJ0IGRyYXdpbmdcbiAgc29ja2V0Lm9uKCdmcmllbmRzRHJhd2luZycsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdmcmllbmRzRHJhd2luZycsIEpTT04ucGFyc2UoZGF0YSkpO1xuICAgICAgdmFyIHN0cm9rZTIgPSBuZXcgUGF0aCgpO1xuICAgICAgdmFyIGZyaWVuZHNEcmF3aW5nID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgIHZhciBlYWNoU3Ryb2tlID0gZnJpZW5kc0RyYXdpbmcuc3Ryb2tlO1xuICAgICAgdmFyIHN0YXJ0X3BvaW50ID0gbmV3IFBvaW50KGZyaWVuZHNEcmF3aW5nLnN0YXJ0WzFdLCBmcmllbmRzRHJhd2luZy5zdGFydFsyXSlcbiAgICAgIHZhciBjb2xvciA9IGZyaWVuZHNEcmF3aW5nLmNvbG9yXG4gICAgICBzdHJva2UyLmZpbGxDb2xvciA9IGNvbG9yO1xuICAgICAgc3Ryb2tlMi5hZGQoc3RhcnRfcG9pbnQpO1xuICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGVhY2hTdHJva2UubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc3Ryb2tlMi5hZGQobmV3IFBvaW50KGVhY2hTdHJva2VbaV0udG9wWzFdLCBlYWNoU3Ryb2tlW2ldLnRvcFsyXSkpO1xuICAgICAgICBzdHJva2UyLmluc2VydCgwLCBuZXcgUG9pbnQoZWFjaFN0cm9rZVtpXS5ib3R0b21bMV0sIGVhY2hTdHJva2VbaV0uYm90dG9tWzJdKSk7XG4gICAgICB9XG4gICAgICBzdHJva2UyLnNtb290aCgpO1xuICAgICAgY29uc29sZS5sb2coJ2hlcmUgaXMgc3Ryb2tlMicsIHN0cm9rZTIpO1xuICAgICAgdmlldy5kcmF3KCk7XG4gICAgICB2aWV3LnVwZGF0ZSgpO1xuICB9KTtcbiAgXG4gIC8vd2hlbiBmcmllbmRzIHN0YXJ0IHRvIGNsZWFyIHRoZSBza3lcbiAgc29ja2V0Lm9uKCdmcmllbmRzQ2xlYXJpbmcnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgY29uc29sZS5sb2coJ2ZyaWVuZENsZWFyaW5nJywgSlNPTi5wYXJzZShkYXRhKSk7XG4gICAgdmFyIHN0cm9rZTQgPSBuZXcgUGF0aCgpO1xuICAgIHZhciBmcmllbmRzQ2xlYXJpbmcgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgIHZhciBjbGVhcmluZ1N0cm9rZSA9IGZyaWVuZHNDbGVhcmluZy5zdHJva2UzO1xuICAgIHZhciBzdGFydF9jbGVhcl9wb2ludCA9IG5ldyBQb2ludChmcmllbmRzQ2xlYXJpbmcuc3RhcnRbMV0sIGZyaWVuZHNDbGVhcmluZy5zdGFydFsyXSlcbiAgICB2YXIgYmxlbmRNb2RlID0gZnJpZW5kc0NsZWFyaW5nLmJsZW5kTW9kZTtcbiAgICB2YXIgY29sb3IgPSBmcmllbmRzQ2xlYXJpbmcuY29sb3JcbiAgICBzdHJva2U0LmJsZW5kTW9kZSA9IGJsZW5kTW9kZTtcbiAgICBzdHJva2U0LmZpbGxDb2xvciA9IGNvbG9yO1xuICAgIHN0cm9rZTQuYWRkKHN0YXJ0X2NsZWFyX3BvaW50KTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgY2xlYXJpbmdTdHJva2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN0cm9rZTQuYWRkKG5ldyBQb2ludChjbGVhcmluZ1N0cm9rZVtpXS50b3BbMV0sIGNsZWFyaW5nU3Ryb2tlW2ldLnRvcFsyXSkpO1xuICAgICAgc3Ryb2tlNC5pbnNlcnQoMCwgbmV3IFBvaW50KGNsZWFyaW5nU3Ryb2tlW2ldLmJvdHRvbVsxXSwgY2xlYXJpbmdTdHJva2VbaV0uYm90dG9tWzJdKSk7XG4gICAgfVxuICAgIHN0cm9rZTQuc21vb3RoKCk7XG4gICAgdmlldy5kcmF3KCk7XG4gICAgdmlldy51cGRhdGUoKTsgIFxuICB9KTtcblxuICAvL3NlbmRpbmcgdGhlIG5pZ2h0IHN0YXJyeSBuaWdodFxuICBzb2NrZXQuZW1pdCgnc2VuZHRoZU5pZ2h0JywgcHJvamVjdCk7XG5cbn0pO1xuIiwiYXBwLmZhY3RvcnkoJ0RyYXdpbmdGYWN0b3J5JywgZnVuY3Rpb24gKCRodHRwKSB7XG4gIHJldHVybiB7XG4gICAgbG9hZENhbnZhczogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICRodHRwLmdldChcIi9cIilcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSk7IiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaG9tZScsIHtcbiAgICAgICAgdXJsOiAnLycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcidcbiAgICB9KTtcbn0pOyIsImFwcC5kaXJlY3RpdmUoXCJuYXZiYXJcIiwgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogXCJFXCIsXG5cdFx0dGVtcGxhdGVVcmw6IFwiL2FwcC9uYXZiYXIvbmF2YmFyLmh0bWxcIlxuXHR9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9